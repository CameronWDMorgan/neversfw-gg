<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Generator | NeverSFW.gg</title>
    <meta name="description" content="A hub for NSFW Images, Videos & Games!">
    <meta name="keywords" content="nsfw, Porn, Hentai, rule34, r34, ai, image, image generator, dalle-3, stable diffusion, web-ui, sonic diffusion, mobians ai, realistic ai, hentai ai">
    <meta name="author" content="MiningP">
    <meta name="juicyads-site-verification" content="da00b2314e338e83450b5bf9040a1fa6">
    
    <link rel="stylesheet" href="../betasite.css">

    <style>
        li{
            list-style-type:square;
        }
        .form-control {
            margin-bottom: 1rem;
        }
        .form-control label,
        .form-control input,
        .form-control textarea,
        .form-control span {
            display: block;
        }
        .form-control input[type="text"],
        .form-control input[type="range"],
        .form-control textarea,
        .form-control button {
            width: 100%;
            margin-top: 0.5rem;
            resize: none;
        }
        .form-control textarea{
            font-size: 20;
        }
        .form-control span {
            margin-top: 0.5rem;
            font-weight: bold;
        }
        .form-control.inline-slider {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .form-control.inline-slider label {
            margin-right: 1rem; /* Adjust as needed */
        }

        .form-control.inline-slider input[type="range"] {
            flex-grow: 1; /* Allows the slider to grow and fill the space */
            margin: 0 1rem; /* Adjust as needed */
        }

        .form-control select {
            width: 100%;
            margin-top: 0.5rem;
            padding: 0.5rem;
            border: transparent;
            border-radius: 4px;
            box-sizing: border-box;
            color: white;
            background-color: #ffffff15;
            font-size: 16px;
        }

        /* Additional styling for dropdown arrow */
        .form-control select::after {
            content: '\25BC';  /* Unicode character for down arrow */
            position: absolute;
            top: 0.8rem;
            right: 1rem;
            font-size: 14px;
            pointer-events: none;
            color: white;
            background-color: #00000015;
        }

        .form-control select[multiple] option:checked {
            color: white;
            background-color: rgb(165, 68, 255);
        }

        .range-value {
            min-width: 3rem; /* Ensures that the value doesn't collapse */
            text-align: center;
        }
        #generatorForm {
            max-width: 600px;
            margin: auto;
        }
        .range-value {
            text-align: center;
        }
        #generateButton {
            background-color: #4caf4f95; /* Green */
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            transition: transform 0.7s, background-color 0.3s; /* Adjust time as needed */
            transform: scale(1) rotate(0deg); /* Default state */
            transform-origin: center; /* Ensures the scaling happens from the center */
        }

        #generateButton:hover {
            transform: scale(1.08) rotate(1deg); 
            background-color: #4CAF50; /* Green */
        }
        #generateButton:active {
            transform: scale(1.1);
            background-color: #ffe600; /* Red */
        }
        #generateButton.generating {
            background-color: #ff0000; /* Red */
            cursor:not-allowed;
        }
        #generateButton.generating:hover {
            transform: scale(0.7) rotate(-1deg); 
        }
        img#generatedImage {
            display: block; /* added display block to remove bottom margin of image */
            margin-top: 2rem;
        }
        .instructions ul {
            text-align: left;
        }
        .center-content {
            text-align: center;
        }
        /* This will ensure your custom highlight styling has precedence */
        .ui-menu-item-wrapper{
            border-radius: 1px;
            border-color: rgba(0, 0, 0, 0.279);
            border-style: solid;
            width: fit-content;
        }
        .custom-highlight {
            background-color: rgba(229, 255, 0, 0.25) !important; /* Example color, use !important to ensure override */
            text-decoration: solid !important;
            border-color: gold !important;
            width: fit-content;
        }
        .autocomplete-space {
            margin-top: 0px !important; /* Adjust this value based on your needs */
        }
        .autocomplete-open {
            margin-top: 105px !important; /* Adjust this value based on your needs */
        }

        .imagesContainer {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40%, 1fr)); /* Adjust the minimum width (200px in this example) */
            grid-template-rows: auto auto;
            grid-column-gap: 20px;
            grid-row-gap: 20px;
        }

        .imagesContainer img {
            width: 100%;
            height: auto; /* Maintains aspect ratio */
            object-fit: contain; /* Maintains aspect ratio without stretching the image */
        }


        #imageOverlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7); /* Dim background */
            display: flex;
            justify-content: center; /* Centers horizontally */
            align-items: center;     /* Centers vertically */
            z-index: 1000; /* Ensure it's above other elements */
        }

        #overlayImage {
            max-width: 80%;
            max-height: 80%;
            object-fit: contain; /* Adds support for maintaining aspect ratio */
        }

        .loraSelection {
            height: 12rem
        }



    </style>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FFEW0Y6QFQ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FFEW0Y6QFQ');
    </script>
</head>
<body>

    <%- include('../partials/_popunder'); -%>

    <div class="page-sidebar">
        <!-- Side Navigation Partial -->
        <%- include('../partials/_sideNav'); -%>
    </div>

    <div class="page-left" style="margin-top: 22rem;">
        <!-- Tower Advert Partial -->
        <%- include('../partials/_towerAdvert'); -%>
    </div>

    <div class="page-right">
        <div class="center-content">
                    
            <img src="https://www.neversfw.gg/nsfwlogobanner.png" class="neversfw-banner">
            <br>
            <br>
                <%- include('../partials/_bannerAdvert'); -%>
            
            <br><br>
            <%- include('../partials/_mobileNavigation'); -%>
            <!-- Banner Advert Partial -->
        </div>

        <div class="round-frosted">

            <div class="instructions">
                <h2>Welcome to the AI Image Generator!</h2>
                <p>Information on how to use it!</p>
                <ul>
                    <li>Prompt: Enter a descriptive and clear text prompt that outlines what you want to generate. Be as specific as possible to get the best results & be sure to use the autocomplete dropdown!</li><br>
                    <li>Negative Prompt: If there are elements you want to avoid in your image, specify them here.</li><br>
                    <p>Here is a recommended Negative Prompt!</p>
                    <a>worst_quality, low_quality, watermark, signature, bad_anatomy, bad_hands, deformed_limbs, blurry, cropped, 
                        cross-eyed, extra_arms, speech_bubble, extra_legs, extra_limbs, bad_proportions, poorly_drawn_hands, text, simple_background, flat_background, </a>
                    <br><br><li>Aspect Ratio: Change the aspect ratio of the image from a square, to portrait or landscape!</li><br>
                    <li>Steps Slider: This controls the number of steps the diffusion process will take. A higher number of steps can result in more detailed images but may take longer to generate.</li><br>
                    <li>Image Quantity: This controls the number of images the image API should generate, the more the slower!</li><br>
                </ul>
            </div>

            <form id="generatorForm" class="autocomplete-space">
                <div class="form-control">
                    <label for="prompt">Prompt:</label>
                    <textarea id="prompt" name="prompt" rows="4" required><%= promptValue %></textarea>
                    <span id="wordCount" class="range-value">Words remaining: 75</span>
                </div>
                
                <div class="form-control">
                    <label for="negativeprompt">Negative Prompt:</label>
                    <textarea id="negativeprompt" name="negativeprompt" rows="4"><%=negativePromptValue%></textarea>
                </div>
                
                <div class="form-control">
                    <label for="aspectRatio">Aspect Ratio:</label>
                    <select id="aspectRatio" name="aspectRatio" value="Square">
                        <option value="Square">Square</option>
                        <option value="Portrait">Portrait</option>
                        <option value="Landscape">Landscape</option>
                    </select>
                </div>


                <div class="form-control">
                    <label for="model">Model:</label>
                    <select id="model" name="model" value="<%=modelValue%>">
                        <option value="furry">Default - Furry Vixens (Anime, Human & Furry)</option>
                        <option value="sonic">SonicDiffusion (Sonic Characters)</option>
                        <option value="cyberreal">Cyberreal (Realistic)</option>
                        <option value="aing">AingDiffusion (Anime)</option>
                        <option value="flat2DAnimerge">flat2DAnimerge (Anime)</option>
                    </select>
                </div>



                <div class="imagesContainer">
                    <div class="form-control">
                        <label for="style-lora">Styles Lora:</label>
                        <% if (data.style) { %>
                            <select class="loraSelection" id="style-lora" name="style-lora" multiple>
                                <% Object.entries(data.style).forEach(([key, value]) => { %>
                                    <option value="<%= key %>"><%= value.name || key %></option>
                                <% }); %>
                            </select>
                        <% } %>
                    </div>
                    
    
                    <div class="form-control">
                        <label for="effect-lora">Effects Lora:</label>
                        <% if (data.effect) { %>
                            <select class="loraSelection" id="effect-lora" name="effect-lora" multiple>
                                <% Object.entries(data.effect).forEach(([key, value]) => { %>
                                    <option value="<%= key %>"><%= value.name || key %></option>
                                <% }); %>
                            </select>
                        <% } %>
                    </div>
    
                    <div class="form-control">
                        <label for="concept-lora">Concepts Lora:</label>
                        <% if (data.concept) { %>
                            <select class="loraSelection" id="concept-lora" name="concept-lora" multiple>
                                <% Object.entries(data.concept).forEach(([key, value]) => { %>
                                    <option value="<%= key %>"><%= value.name || key %></option>
                                <% }); %>
                            </select>
                        <% } %>
                    </div>
    
                    <div class="form-control">
                        <label for="clothing-lora">Clothing Lora:</label>
                        <% if (data.clothing) { %>
                            <select class="loraSelection" id="clothing-lora" name="clothing-lora" multiple>
                                <% Object.entries(data.clothing).forEach(([key, value]) => { %>
                                    <option value="<%= key %>"><%= value.name || key %></option>
                                <% }); %>
                            </select>
                        <% } %>
                    </div>

                </div>
                <br><br>
                <a>Use CTRL / Shift Left Click to select multiple Lora's! Please report any broken loras on the </a><a href="https://discord.gg/2QXV66RVMG">Discord!</a>



                <div class="form-control inline-slider">
                    <label for="steps">Steps:</label>
                    <input type="range" id="steps" name="steps" min="15" max="150" step="1" value="15">
                    <span id="stepsValue" class="range-value">15</span>
                </div>

                <div class="form-control inline-slider">
                    <label for="quantity">Image Quantity:</label>
                    <input type="range" id="quantity" name="quantity" min="1" max="6" step="1" value="4">
                    <span id="quantityValue" class="range-value">4</span>
                </div>   

                <center>
                    <% if (session.loggedIn == false) {
                        <p style="color: rgba(255, 255, 255, 0.249)"> Register for up to 150 steps from 50!</p>
                     } %>
                    <a href="/uploadArt"><h2>Be sure to upload your best work to the website!</h2></a>
                    <p style="color: rgba(255, 255, 255, 0.8)">(Just be sure to use the ai-generated tag when you upload or else your post will be removed!)</p>
                    <br><br>
                </center>
                
                <div class="form-control">
                    <button type="submit" id="generateButton">Generate Image</button>
                </div>
            </form>
            
            <center>
                <div id="response"></div>
                <div id="queuePosition" style="display: none;">Your position in queue: <span style="color: gold;" id="positionNumber"></span></div>
                <br>
                <div id="imagesContainer" class="imagesContainer"></div>
                
            </center>
        </div>


        <div style="height: 20rem;"></div>

        <!-- Footer Partial -->
        <%- include('../partials/_footerNew'); -%>
        
    </div>

    <div id="imageOverlay" style="display:none;">
        <img id="overlayImage" src="" alt="Enlarged view" />
    </div>    


    <script>

    </script>








    <script>
        function updateWordCount() {
            const promptTextarea = document.getElementById('prompt');
            const negativePromptInput = document.getElementById('negativeprompt');

            const promptWordCount = promptTextarea.value.trim().split(/\s+/).filter(word => word !== '').length;
            const negativePromptWordCount = negativePromptInput.value.trim().split(/\s+/).filter(word => word !== '').length;

            const totalWordCount = promptWordCount + negativePromptWordCount;
            const remainingWords = 75 - totalWordCount;

            // Display the total word count
            document.getElementById('wordCount').innerText = `Words remaining: ${remainingWords}`;

            // // Disable the generate button if the total word count exceeds the limit
            // const generateButton = document.getElementById('generateButton');
            // generateButton.disabled = remainingWords < 0;
        }

        // Add event listener for input on both the prompt textarea and the negative prompt input
        document.getElementById('prompt').addEventListener('input', updateWordCount);
        document.getElementById('negativeprompt').addEventListener('input', updateWordCount);

        // Initial update
        updateWordCount();
    </script>






    <script>
        document.getElementById('imagesContainer').addEventListener('click', function(event) {
            if (event.target.tagName === 'IMG') {
                showOverlay(event.target.src);
            }
        });

        let currentImageIndex = 0;
        let imagesSrcList = [];

        function showOverlay(src) {
            const overlay = document.getElementById('imageOverlay');
            overlay.style.display = 'flex'; // Change to 'flex' to activate flexbox
            document.getElementById('overlayImage').src = src;
    
            // Disable scrolling on the body
            document.body.style.overflow = 'hidden';
            const overlayImage = document.getElementById('overlayImage');

            overlay.style.display = 'block';
            overlayImage.src = src;
            currentImageIndex = imagesSrcList.indexOf(src);

            // Add event listener for keydown
            document.addEventListener('keydown', handleArrowKeyPress);
        }

        function hideOverlay() {
            const overlay = document.getElementById('imageOverlay');
            overlay.style.display = 'none';
            
            // Enable scrolling
            document.body.style.overflow = '';

            // Remove event listener to prevent interference when overlay is not active
            document.removeEventListener('keydown', handleArrowKeyPress);
        }

        function handleArrowKeyPress(event) {
            if (!imagesSrcList.length) return; // Exit if no images are available

            if (event.key === 'ArrowRight') {
                currentImageIndex = (currentImageIndex + 1) % imagesSrcList.length;
            } else if (event.key === 'ArrowLeft') {
                currentImageIndex = (currentImageIndex - 1 + imagesSrcList.length) % imagesSrcList.length;
            } else {
                return; // Exit if not a left/right arrow key
            }
            document.getElementById('overlayImage').src = imagesSrcList[currentImageIndex];
        }

        // Function to populate imagesSrcList when images are loaded
        function populateImagesSrcList() {
            imagesSrcList = Array.from(document.querySelectorAll('#imagesContainer img')).map(img => img.src);        }

        // Add click event listener to the overlay to hide it when clicked
        document.getElementById('imageOverlay').addEventListener('click', hideOverlay);
    </script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>

    <script>
        var maxStepsCountWanted = `<%= session.loggedIn ? 150 : 50 %>`
        var maxImageQuantityWanted = 6;
    </script>
    
    <script src="../scripts/ai-slider-balancing.js"></script>

    <script src="../scripts/ai-form.js?v2"></script>
    <script src="../scripts/ai-autocomplete.js"></script>
    <script src="../scripts/ai-strength.js"></script>
</body>
</html>
